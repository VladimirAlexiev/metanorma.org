---
layout: author-docs
title: Mathematical Expressions
---
//Dump from existing docs

== General

Metanorma AsciiDoc accepts mathematical input in these formats:

* AsciiMath
* LaTeX math
* MathML

Math can be entered using one of the following mechanisms:

* the `\stem:[...]`, `\asciimath:[...]` and the `\latexmath:[...]` commands; and
* the `[stem]`, `[asciimath]`, `[latexmath]` blocks delimited with `\++++{blank}`

The math syntax used by `\stem:[...]` and `[stem]` blocks depends on
the value of the document attribute `:stem:`. It can be set to:

`:stem: latexmath`:: any markup within `stem` is interpreted as LaTeX math
`:stem: asciimath`:: any markup within `stem` is interpreted as AsciiMath
`:stem:`:: (default) when left empty, AsciiMath is selected

`\stem:[...]` and `[stem]` markup that contains MathML markup
(as detected by an initial `<math ... >`) is interpreted as MathML.

MathML is used as the internal representation of STEM expressions in Metanorma.


== Using AsciiMath

AsciiMath can be entered using the `\asciimath:[...]` command and the
`[asciimath]` block delimited with `\++++{blank}`.
The `\stem:[]` and `[stem]` blocks can also be used if the document attribute
`:stem: asciimath` has been specified in the document.

AsciiMath is converted into MathML using the
https://github.com/asciidoctor/asciimath[asciimath] gem.

The syntax of AsciiMath recognised by the `asciimath` gem is more strict
than the common MathJax processor of AsciiMath.
For example, `asciimath` insists on numerators being bracketed.

EXAMPLE:

(IEV 103-01-03)

[source,asciidoc]
----
The derivative of a distribution stem:[D] is another distribution
stem:[D'] defined for any function stem:[f](stem:[x]) by
stem:[D^( ' ) ( f ) = - D ( d f // d x )].
----

(ISO 10303-55, Clause 2)

[source,asciidoc]
----
[stem]
++++
f -= lambda x (a * x + b)
++++
----

NOTE: Some math expressions are NOT supported by AsciiMath -- in that
case it is necessary to use LaTeX math or MathML input.


== Using LaTeX math

LaTeX math can be entered using the `\latexmath:[...]` command and the
`[latexmath]` block delimited with `\++++{blank}`.
The `\stem:[]` and `[stem]` blocks can also be used if the document attribute
`:stem: latexmath` has been specified in the document.

LaTeX math is converted into MathML using the
https://github.com/plurimath/latexmath[latexmath] gem, which generates
output compliant with the deterministic output of the
https://dlmf.nist.gov/LaTeXML/[NIST LaTeXML] suite.

NOTE: LaTeX math parsing of the
https://dlmf.nist.gov/LaTeXML/manual/commands/latexmlmath.html[LaTeXML's `latexmlmath` command]
is deterministically accurate.
The https://github.com/plurimath/latexmath[latexmath] gem was created
to generate identical output to the `latexmlmath` command.

Unicode characters in the LaTeX source are translated into LaTeX escapes
through the https://github.com/metanorma/unicode2latex[unicode2latex] gem.

EXAMPLE:

(ISO 10303-110, Clause 4)
[source,asciidoc]
----
The only change from the above example would be the
nondimensionalization of viscosity, which would become,
latexmath:[\tilde{\tilde{\mu}} = mu / (rho_infty c_infty L)].
----

(ISO 10303-110, Clause 4)
[source,asciidoc]
----
[latexmath]
++++
\begin{array}{c@{\qquad}c@{\qquad}c}
  \tilde{x} = x/L, \tilde{u} = u/c_\infty, \tilde{\rho} = \rho/\rho_\infty,
  \tilde{y} = y/L, \tilde{v} = v/c_\infty, \tilde{p} = p/(\rho_\infty c_\infty^2),
  \tilde{z} = z/L, \tilde{w} = w/c_\infty, \tilde{\mu} = \mu/\mu_\infty,
\end{array}
++++
----



The LaTeX math `eqnarray` environment is not supported in Metanorma as
it is not supported by LaTeXML and the latexmath gem.
It is also not recommended by the general
LaTeX community due to inconsistencies in vertical alignment and other aspects
(see link:https://www.tug.org/pracjourn/2006-4/madsen/madsen.pdf[Madsen]).

The proper LaTeX math syntax used to replace existing `eqnarray`
equations is to place the equations in separate blocks concatenated
with `+`.

EXAMPLE:

These equations using the `eqnarray` environment:

[source,asciidoc]
--
[latexmath]
++++
\begin{eqnarray*}
  \bf{z^\prime} & = & \bf{\zeta} \\
  \bf{x^\prime} & = & \langle \bf{\eta} \times \bf{\zeta} \rangle
\end{eqnarray*}
++++
--

should be re-arranged as:

[source,asciidoc]
--
[latexmath]
++++
\bf{z^\prime} = \bf{\zeta}
++++
+
[latexmath]
++++
\bf{x^\prime} = \langle \bf{\eta} \times \bf{\zeta} \rangle
++++
--

== Formulae

Formulae are marked up as `[stem]` blocks.
Any explanation of symbols in the formula is given in a definition list,
either preceded by a "`where`" paragraph (in English),
or [added in https://github.com/metanorma/metanorma-standoc/releases/tag/v1.6.3] marked up with `[%key]`.

For example:

[source,asciidoc]
--
[[formulaA-1]]
[stem]
++++
w = (m_D) / (m_s)
++++

where

stem:[w]:: is the mass fraction of grains with a particular defect in the test sample;
stem:[m_D]:: is the mass, in grams, of grains with that defect;
stem:[m_S]:: is the mass, in grams, of the test sample.
--

[source,asciidoc]
--
[[formulaA-1]]
[stem]
++++
w = (m_D) / (m_s)
++++

[%key]
stem:[w]:: is the mass fraction of grains with a particular defect in the test sample;
stem:[m_D]:: is the mass, in grams, of grains with that defect;
stem:[m_S]:: is the mass, in grams, of the test sample.
--

which renders

.Example of a block stem equation in Metanorma.
image::/assets/author/topics/document-format/text/fig-stem-equality.png[Example of a block stem equation in Metanorma]


Inequalities are indicated through the option attribute `%inequality`:

[source,asciidoc]
--
[stem%inequality]
++++
A < B
++++
--

which renders

.Example of a block stem inequality in Metanorma.
image::/assets/author/topics/document-format/text/fig-stem-inequality.png[Example of a block stem inequality in Metanorma]


In most flavours, equations and inequalities are both referenced in the same way, as "`Formula`".

In some flavours (e.g. ITU), they are referenced differently as "`Equations`" and "`Inequalities`".
