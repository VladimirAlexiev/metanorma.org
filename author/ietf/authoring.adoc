---
layout: ietf-flavour
---

= Writing IETF I-Ds and RFCs using&nbsp;AsciiDoc&nbsp;&&nbsp;Metanorma

This documentation describes how to write a document for the Internet Draft and RFC
series using the AsciiDoc markup language and the Metanorma toolchain.

TIP: https://datatracker.ietf.org/doc/draft-ribose-asciirfc/[A summary guide to authoring I-Ds and RFCs using AsciiDoc]
is also available at IETF Datatracker, with source
https://github.com/riboseinc/rfc-asciidoc-rfc[on GitHub].

Below outlines how Metanorma-IETF interprets AsciiDoc markup,
which document metadata attributes it expects, and what output formats it supports.

[NOTE]
====
- See also link:../[Metanorma-IETF flavour quickstart page].
- If youâ€™re new to Metanorma, make sure to check out
link:/docs/authoring/markup/[Authoring documents with Metanorma]
for guidelines & references relevant to Metanorma authoring in general.
====

== Output formats

The following outputs are generated:

* RFC XML v2
** Metanorma `doctype`: `rfc2`
** Metanorma file extension: `xmlrfc` (not `xml`!)

* RFC XML v3
** Metanorma `doctype`: `rfc3`
** Metanorma file extension: `xmlrfc` (not `xml`!)

The "`xml2rfc`" Vocabulary (hereinafter "`RFC XML`") is an XML-based language
used for writing
https://www.ietf.org/id-info/guidelines.html[Internet-Drafts]
and https://tools.ietf.org/html/rfc7322[RFCs (RFC7322)].

Metanorma-IETF allows you to author these types of documents in AsciiDoc, and outputs
RFC XML output in both v3 and v2 formats:

* v3 RFC XML (https://tools.ietf.org/html/rfc7991[RFC 7991])
* v2 RFC XML (https://tools.ietf.org/html/rfc7749[RFC 7749])

== Document header

`:doctype:`::
    Set the `doctype` attribute to specify the status of this document.

    - `:doctype: internet-draft` sets the document as an Internet-Draft (default value):
        * `rfc/front/seriesInfo@name` attribute will be set to `Internet-Draft` (in v3)
        * `rfc/front/seriesInfo@value` will be set to the `:name:` attribute, stripping any file suffixes, but including any draft number; e.g. `draft-ietf-somewg-someprotocol-07` (in v3)
        * `rfc@docName` will be set to the `:name:` attribute (in v2)

    - `:doctype: rfc` sets the document as an RFC:
        * `rfc/front/seriesInfo@name` attribute will be set to `RFC` (in v3)
        * `rfc/front/seriesInfo@value` will be set to the `:name:` attribute, stripping the initial `rfc-` prefix and any file suffixes (in v3)
        * `rfc@number` will be set to the `:name:` attribute (in v2)

`:no-rfc-bold-bcp14:`::
Optional. Default value `true`. Allowed values: `true`, `false`.
verride default assumption that boldface uppercase BCP14 word is to be rendered with `bcp14` tag.

`:inline-definition-lists:`::
Optional. Default value `false`. Allowed values: `true`, `false`.
(Only applies to v2. By default, `<vspace blankLines="1">` is inserted after
the definition in a v2 definition list, to satisfy the requirement from `idnits` validation
that definition terms be separated by a carriage return from the definition. That is, by
default inline definition lists are rendered as paragraphing definition lists. If the option is
on, the additional `vspace` element is not added, and inline definition lists are left as is.)


== Markup

[NOTE]
====
The document model of AsciiDoc and RFC XML are different. In particular,

* AsciiDoc and RFC XML differ in where they allow anchors to be placed:
Asciidoctor does not allow anchors within tables and lists, and RFC XML v3 does
not permit anchors for the `note` or `abstract` elements, while RFC XML v2
uses anchors for much fewer block elements (e.g. `artwork`, `list`.)
* AsciiDoc has a more restrctive block model: it regards elements such as
admonitions, lists, and tables as blocks, and does not allow them to be nested
within paragraphs.

As a result, it may be necessary to postedit the RFC XML output, if the block
model produced does not reflect the intended structure accurately.
====

NOTE: Metanorma-IETF validates all RFC XML generated through the RELAXNG schema definitions
of RFC XML. While Metanorma attempts to generate valid RFC XML, some AsciiDoc
text may not align with the RFC XML document model, and any highlighted syntax
errors will also need to be rectified in postediting, before processing the
generated XML further.

=== Abstract

Any paragraphs following the document header are treated as the abstract
(`front/abstract`), whether or not they are in abstract style. The abstract is
terminated by either the first section header (which ends the document
preamble), or an admonition (e.g. `note`).

Any admonitions before the first section header are treated as notes (`front/note`).

[source,asciidoc]
----
[[abstract-id]] <1>
[abstract]
This is an abstract <2>

NOTE: This is a note <3>

[NOTE,remove-in-rfc=true] <4>
.Note 2 Title <5>
===
This is another note <3>
===
----
<1> v3 only: `front/abstract@anchor` (attribute only available in v3)
<2> `front/abstract`
<3> `front/note`
<4> v3 only: `front/note@removeInRFC` (attribute only available in v3)
<5> v3: `front/note/name`; v2: `front/note@title` (mandatory attribute; if not provided, `NOTE` is supplied)


=== Source code listings

In RFC XML, `sourcecode` (v3) and `artwork` (v2) elements only occur within a
`figure` wrapper; Metanorma-IETF supplies that wrapper if it is not provided
explicitly.

[source,asciidoc]
.Without Figure Wrapper
--
[[id]] <1>
.Source code listing title <2>
[source,type,src=uri,align,alt] <3>
----
begin() {
  source code listing <4>
}
----
--
<1> v3: `figure/sourcecode@anchor`; v2: `figure@anchor` (moved into supplied wrapper: anchors not supported on `artwork`)
<2> v3: `figure/sourcecode@name`; v2: `figure/artwork@name`
<3> v3: `figure/sourcecode@type`; `figure/sourcecode@src` (`align` and `alt` not supported). If `src` is present, the listing is not expected to have any content: content is taken from the hyperlink in the attribute. v2: `figure/artwork@type`, `figure/artwork@src`, `figure/artwork@align`, `figure/artwork@alt`.
<4> v3: `figure/sourcecode`; v2: `figure/artwork`

[source,asciidoc]
.With Figure Wrapper
--
[[id]] <1>
[align,alt,suppress-title] <2>
.Figure 1 <3>
====
Preamble text <4>

[[id1]] <5>
.Source code listing title <6>
[source,type,src=uri,align,alt] <7>
----
begin() {
  source code listing <8>
}
----

Postamble text <9>
====
--
<1> `figure@anchor`
<2> v2 only: `figure/artwork@align`, `figure/artwork@alt`, `figure@suppress-title` (attributes only available in v2)
<3> `figure/name`
<4> v2 only: `figure/preamble` (only available in v2)
<5> v3: `figure/sourcecode@anchor`; v2: Not supported: use `figure@anchor`
<6> v3: `figure/sourcecode@name`; v2: `figure/artwork@name`
<7> v3: `figure/sourcecode@type`; `figure/sourcecode@src` (`align` and `alt` not supported). If `src` is present, the listing is not expected to have any content: content is taken from the hyperlink in the attribute. v2: `figure/artwork@type`, `figure/artwork@src`, `figure/artwork@align`, `figure/artwork@alt`.
<8> v3: `figure/sourcecode`; v2: `figure/artwork`
<9> v2 only: `figure/postamble` (only available in v2)


=== ASCII Art and Images

In RFC XML, `artwork` elements only occur within a
`figure` wrapper; Metanorma-IETF supplies that wrapper if it is not provided
explicitly.


[source,asciidoc]
.Ascii-Art Without Figure Wrapper
--
[[id]] <1>
.Figure2.jpg <2>
[align=left|center|right,alt=Ascii Art,type=text/plain] <3>
....
------------------------
|        Ascii Art     |
------------------------ <4>
....
--
<1> v3 only: `figure/artwork@anchor`; v2: `figure@anchor` (moved into supplied wrapper: anchors not supported on `artwork`)
<2> `figure/artwork@name`
<3> `figure/artwork@align`, `figure/artwork@alt`; `figure@type` (attribute only available in v2)
<4> `figure/artwork`

[source,asciidoc]
.Image Without Figure Wrapper
--
[[id]] <1>
.Figure2.jpg <2>
[align=left|center|right,alt=alt_text,type=img/jpeg] <3>
image::filename.jpg[alt_text,700,200] <4>
--
<1> v3 only: `figure/artwork@anchor`; v2: `figure@anchor` (moved into supplied wrapper: anchors not supported on `artwork`)
<2> `figure/artwork@name`
<3> `figure/artwork@align`, `figure/artwork@alt`; `figure/artwork@type` (only available in v2, intended to be a MIME type; v3: populated as either `svg` or `binary-art` depending on file suffix)
<4> `figure/artwork@src`, `figure/artwork@alt`, `figure/artwork@width` (deprecated in v3), `figure/artwork@height` (deprecated in v3)


[source,asciidoc]
.With Figure Wrapper
--
[[id]] <1>
[align,alt,suppress-title] <2>
.Figure 1 <3>
====
Preamble text <4>

[[id]] <5>
.Figure2.jpg <8>
[align=left|center|right,alt=alt_text,type=text/plain] <6>
....
Figures are
      only permitted to contain listings (sourcecode),
           images (artwork),
or literal (artwork) <7>
....
[[id]] <5>
.Figure2.jpg <8>
[align=left|center|right,alt=alt_text,type=img/jpeg] <9>
image::filename.jpg[alt_text,700,200] <10>

Postamble text <11>
====
--
<1> `figure@anchor`
<2> v2 only: `figure/artwork@align`, `figure/artwork@alt`, `figure@suppress-title` (attributes only available in v2)
<3> `figure/name`
<4> v2 only: `figure/preamble` (only available in v2)
<5> v3: `figure/artwork@anchor`; v2: Not supported: use `figure@anchor`
<6> `figure/artwork@align`, `figure/artwork@alt`; `figure@type` (attribute only available in v2)
<7> `figure/artwork`
<8> `figure/artwork@name`
<9> `figure/artwork@align`, `figure/artwork@alt`; `figure/artwork@type` (only available in v2, intended to be a MIME type; v3: populated as either `svg` or `binary-art` depending on file suffix)
<10> `figure/artwork@src`, `figure/artwork@alt`, `figure/artwork@width` (deprecated in v3), `figure/artwork@height` (deprecated in v3)
<11> v2 only: `figure/postamble` (only available in v2)


=== Mathematical examples

Mathematical examples are treated identically to literals, and are rendered as `artwork` in both v2 and v3;
however their default alignment is set as `center`. As with inline stem expressions, they are treated identically
to monospace expressions in the RFC XML output; they are not currently rendered as MathML or any other notation.

=== Lists

RFC XML v2 does not support multiparagraph list items. Following the specification recommendation,
paragraphs within v2 list items are replaced with `vspace` tages.

=== Sidebar (v3 only)

[source,asciidoc]
--
[[id]] <1>
****
Sidebar <2>
****
--
<1> `aside@anchor`
<2> `<aside>Sidebar</aside>`

=== Tables

The converter respects the AsciiDoc (horizontal) align attributes of cells (v2,
v3), column widths (v2), and `colspan`, `rowspan` attributes (v3).

(Exceptionally,
column widths specified for v2 as `"1,1,1,1,1,1...."` will be ignored, since Asciidoctor
internally treats them identically to unspecified column widths on a table.)

[source,asciidoc]
--
[[id]] <1>
[suppress-title=true|false,align=left|center|right,grid=all|cols|none|rows] <2>
.Table Title <3>
|===
|[[id]] head | head <4>

h|header cell | body cell <5>
| | [[id]] body cell <6>

|foot | foot <7>
|===
--
<1> v3: `table@anchor`; v2: `texttable@anchor`
<2> v2: `texttable@suppress-title`, `texttable@align`, `texttable@style` (attributes only available in v2). Mapping of Asciidoc grid attribute to RFC XML style attribute is: `all` > `all`, `cols` > `full`, `none` > `none`, `rows` > `headers` (although the two are not strictly equivalent).
<3> v3: `table/name`; v2: `texttable@title`
<4> v3: `table/thead/tr/td`; v2: `texttable/ttcol@id` (attribute only available in v2), `texttable/ttcol`
<5> v3: `table/tbody/tr/th`, `table/tbody/tr/td`; v2: `texttable/c`, `texttable/c`
<6> v3: `table/tbody/tr/td@anchor` (attribute only available in v3)
<7> v3: `table/tfoot/tr/td`; v2: `texttable/c`

NOTE: v3 permits table cells to contain block elements, such as paragraphs and lists. (This is done in Asciidoc by prefixing
the table cell with `a|`.) However v2 only permits inline tagging, and any block tags are ignored.

=== References: Embedded in Document

References are expected to be provided in raw RFC XML v2 format. For v3, a list of crossreferences may
precede the block of references, with alternative text. This will not be rendered, but it will be used
to populate `displayreference` elements, mapping the reference anchors to display text. For example,
a list entry `[[[ref1,alt1]]]` means that any instances of the anchor `ref1` should be displayed as `alt1`,
and is rendered as `<displayreference target="ref1" to="alt1"/>`.

RFC requires two separate bibliographies, one for normative and one for informative references;
either can be omitted. All bibliography sections in the must be styled with the prefix `[bibliography]`,
and must appear in sequence, before any appendices.

By default, the references cited must be included as raw RFC XML, and separated
into the normative and informative sections.

[source,asciidoc]
--
[[id]] <1>
[bibliography]
== Normative References
* [[[ref1,alt1]]] <2>
++++
(raw XML) <3>
++++

[[id]] <1>
[bibliography]
== Informative References
++++
(raw XML) <2>
++++
--
<1> `back/references@anchor` (only in v3)
<2> `back/displayreference@target`, `back/displayreference@to` (only in v3)
<3> `back/references/reference`

In postprocessing, bibliographic entries available from http://xml.resource.org/public/rfc are replaced
with external references to that entry, using XML entities in RFC XML v2, and XML includes
in RFC XML v3. Do not insert your own entities or XML includes into the references;
Metanorma-IETF will have difficulty processing them.


=== References: External Directory

As an alternative, the document attribute `:biblio-dir:` can nominate a directory in which separate XML files can be placed, one for each reference to be included. (RFC XML v3 referencegroup elements will also be recognised as files.)
Metanorma-IETF will read in from that directory only the files that have actually been cited,
and insert them into the appropriate bibliography,
without the references needing to be given under the bibliographies as above.
(In fact, any XML already provided will be deleted.)

By default, references will be considered informative; the document attribute `:normative:`
can be used to specify a comma-delimited list of normative references.

Metanorma will issue a warning if any cited reference is not included in the directory.
External references do not have to be included in the directory:
they will be recognised by comparing their anchors against the external bibliography cache,
and referenced as entities or includes.
Particular drafts of Internet-Draft documents do still need to be included as separate documents
(see <<external-ref-lookup>>.)

For example:

[source,asciidoc]
--
= The Holy Hand Grenade of Antioch
Arthur Pendragon
:doctype: internet-draft
:workgroup: silly
:biblio-dir: refs <1>
:normative: RFC2119, AsciiDoc <2>

[[xyz]]
== Hello
Hello

* a <<RFC2119,2.3 of: See internet draft subsection>> <3>
* b <<I-D.abarth-cake>>
* b2 <<I-D.abarth-cake,what>>
* b1 <<I-D.abarth-cake,2.3 of: See internet draft subsection>> <3>
* c <<xyz,format=counter: xyzzy>> <4>
* d <<biblio>> <4>
* e <<AsciiDoc,AsciiDoctor>>
* f <<mathrefs>>


[[biblio]]
=== Biblio
See biblio

[bibliography]
== Normative References <5>

[bibliography]
== Informative References <6>
--
<1> The RFC XML references are included in the directory `./refs`, with one file per reference. For example, we would expect it to contain a file corresponding to the reference `mathrefs`. A file corresponding to `RFC2119` is optional, and in fact will be ignored, since the anchor is recognised as an external reference. A file corresponding to `I-D.abarth-cake` will not be ignored, if that file contains a `seriesInfo` element nominating a specific draft version.
<2> The references in the `./refs` directory are by default considered informative; this attribute indicates that `RFC2119` and `AsciiDoc` are to be considered normative.
<3> References are recognised in `relref` as well as `xref` elements.
<4> Metanorma-IETF differentiates between bibliographic references and crossreferences to other anchors within the document.
<5> The bibliographic headers need to be provided as above, and its titles are expected to be "Normative References" and "Informative References";
    Metanorma will look for those titles specifically in order to insert the references it identifies from the file. However, no XML content is expected to be provided under each heading, and any XML content that is provided will be ignored.
